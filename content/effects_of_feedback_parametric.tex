\chapter{A gray box analysis on the effect of torque feedback during cycling under lateral perturbations} \label{hapticFB}

\section{Introduction}

In the lateral perturbation experiments conducted for two experimental conditions (torque feedback on and off), a statistical significant difference for control effort and task performance  could not be discerned. This indicated that the  rider despite the reduced feedback and changed bicycle dynamics managed to compensate and produce similar outputs. For this reason, a gray box analysis is conducted in this work to get further insights on what and why might have led to the findings derived in \cite{dialynaseffect}.

\section{Methods}
\begin{enumerate}
    \item Black box identification : the procedure described in \cite{dialynaseffect} is followed to produce impulse response functions (IRFs), thorugh the use of a FIR model, for steering angle \ensuremath{\delta}, roll angle \ensuremath{\phi}, yaw angle \ensuremath{\psi} and steer torque  \ensuremath{T_\delta}. In the case of \ensuremath{T_\delta} instead of considering the whole bicycle rider closed loop system as a black box, the bicycle rider open loop is chosen with input the disturbance \ensuremath{w} and output the control input \ensuremath{T_\delta}.
    \item The produced IRFs \ensuremath{h^\delta(\tau)}, \ensuremath{h^\phi(\tau)}, \ensuremath{h^\psi(\tau)}, \ensuremath{h^{T_\delta}(\tau)} are filtered using zero-phase low pass filter with a cutoff frequency of 10 \si{\hertz}.
    \item The IRFs are averaged over all participants in order to produce the mean rider response. The variance accounted for \ensuremath{\mathit{VAF}} between each individual's  response and the mean rider's is calculated. The rider with the highest  \ensuremath{\mathit{VAF}}  accross all speed levels  is chosen as the median rider. All further analysis is conducted on the response of the median rider.
    \item The IRFs of the median rider are convolved with the measured disturbances of each run to produced the filtered output \ensuremath{y_\delta(t)}, \ensuremath{y_\phi(t)}, \ensuremath{y_\psi(t)}, \ensuremath{y_{T_\delta}(t)}.
    \item Zero Delay Model gray box identification: A gray box model  is fit to the measured lateral
    force and the filtered response of the FIR
    model for each run. This is repeated for three conditions. In the first, the control process dynamics approximate a normal bicycle and are similar to the experimental condition described in \cite{dialynaseffect} and refered to as haptic feedback on (haptics on), while  the rider has the torque feedback loop connected. In the second, the control process dynamics approximate again a normal bicycle, but the interal torque feedback loop of the rider is severed. In the third the steering configuration dyanmics change to simulate the experimental conditions described in \cite{dialynaseffect} and refered to as haptic feedback off (haptics off) but the rider's internal torque feedback loop is present.
    \item Vairable Delay Model gray box identification: The model is update with time delays. The model  is fit to the measured lateral force and the filtered response of the FIR model for each run. This is repeated for the three conditions described above. 
    \item Reafferent Optimal Prdiction (ROP) Model gray box identification: The gray box model is updated with a delay compensation algorith. The model is fit to the measured lateral force and the filtered response of the FIR model for each run. This is repeated for the three conditions described above.
    \item Assessment on the importance of torque feedback is made based on the the covariance of the identified gray box parameters and the change of \ensuremath{\mathit{VAF}}  in the lateral force to steer angle fit between conditions.
    \item Assessment on the delay compensation strategy used is made based on the fitting perfomance accross gray box models. Additionally the predictor is compared with a more conventional apporach found in motor control literature. 

\end{enumerate}
\subsection{Bicycle Model}
The bicycle model used is the so called Whipple-Carvalho model the dynamics of which have been expressed in a set of linearized equations by \citet{meijaard2007linearized}. In the original model three assumptions are made. The first is that the rider is rigidly attached in the saddle with the mass of the arms and legs acting as a point. Secondly, the contact between tire and ground is modelled as a non slipping rolling point contact meaning that the wheels can rotate without lateral slip. Lastly it is assumed that the total energy of the system is preserved. The resulting non-holonomic mechanical model has three velocity degrees of freedom, the forward speed, the rear frame roll rate \ensuremath{\dot{\phi}} and the steering rate \ensuremath{\dot{\delta}}.
\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.3]{images/figure3_1.png}
    \caption{ The Whipple-Carvalho bicycle model consists of four rigid bodies: rear wheel R, rear frame B, front frame H and front wheel F connected via hinges. The center of mass locations are expressed relative to the x - and z -coordinates shown (with origin at P and y pointing towards the reader). The other parameters shown are the steer axis tilt \ensuremath{\lambda}, wheelbase \ensuremath{w} and trail \ensuremath{c}. The model at its most expanded form is described by 25 parameters.\cite{meijaard2007linearized}}
    \label{fig:figure2}
\end{figure}
The lateral motion is described by  two coupled second order differential equations given by \cref{eq:paper1}.
\begin{equation}
    \mathbf{M} \ddot{q}+v \mathbf{C}_{1} \dot{q}+\left[g \mathbf{K}_{0}+v^{2} \mathbf{K}_{2}\right] \mathbf{q}=\mathbf{f}
    \label{eq:paper1}
\end{equation}

where \ensuremath{\mathbf{q}} is a vector containing the roll and steer angles, \ensuremath{\mathbf{f}} is a vector containing the roll and steer torques, \ensuremath{g} is the gravitational acceleration and \ensuremath{\mathbf{M},\;v\mathbf{C}_{1},\;g \mathbf{K}_{0}+v^{2} \mathbf{K}_{2}} are the "mass", "damping" and "stiffness" ratios in matrix form respectively. The entries in the constant coefficient matrices  \ensuremath{\mathbf{M},\mathbf{C}_{1}, \mathbf{K}_{0},  \mathbf{K}_{2}} are calculated from a set of 25 bicycle parameters related to inertial and design properties of the steer by wire bicycle (see \cref{tb:paper1}).

To determine the stability of the open loop system in a straight ahead motion the characteristic polynomial derived from
\begin{equation}
    \operatorname{det}\left(\mathbf{M} \lambda^{2}+v \mathbf{C}_{1} \lambda+g \mathbf{K}_{0}+v^{2} \mathbf{K}_{2}\right)=0
    \label{eq:paper2}
\end{equation}

is solved for a forward speed range from 0 to 10 \si{\meter\per\second} where \ensuremath{\lambda} are the eigenvalues of the system (see \cref{fig:paper2}). The two interesting eigenmodes defined by the locus plot are the weave and capsize. The weave corresponds to an oscillatory mode as can be seen by the existence of imaginary parts and represents a motion in which the bicycle sways about its heading. The oscillatory motions exponentially fades when forward speed is larger than 4.39 \si{\meter\per\second}. The capsize on the other hand has an eigenvector dominated by lean and leads to a gradual roll drift to infinity when the eigenvalue crosses the zero line around 6.67 \si{\meter\per\second}.
\begin{figure}[ht]
    \centering
    \captionsetup{justification=centering,margin=2cm}

    \includegraphics[scale=0.6]{images/root_locus_steerbywire.png}
    \caption{Root locus plot of the steer by wire bicycle. Dotted blue lines indicate the real part of the eigenvalues while dotted cyan show the imaginary part. The stable region corresponds to speeds  \ensuremath{4.39\lessapprox v \lessapprox 6.67\; \si{\meter\per\second}}}
    \label{fig:paper2}
\end{figure}
Since in the experimental setup the task could not be isolated to purely balance the equations are extended to include heading. Heading is defined as a linear combination of steer angle and steer rate as expressed by \citet{meijaard2007linearized} in \cref{eq:paper3}. 

\begin{equation}
    \dot{\psi}=\frac{v \delta+c \dot{\delta}}{w} \cos \lambda
    \label{eq:paper3}
    \end{equation}

When modelling the feedback off case of the steer-by-wire bicycle the dynamics of the plant need to change accordingly. In that configuration the forcing steering input is directly proportional to steering acceleration times the inertia of upper handlebar assembly, for this reason the second of the set of equations in \ref{eq:paper1} is replaced by :
\begin{equation}
    I_{F_{xx}}\ddot{\delta} = T_{\delta}
\end{equation}

 For control purposes \cref{eq:paper1} is expressed in state space form with state vector \ensuremath{\mathbf{x}=[\dot{\phi}, \dot{\delta}, \phi, \delta, \psi]^{T}}, forcing input \ensuremath{\mathbf{f}=T_{\delta}} and output equal to the full state. The  bike is assumed to be controlled only by a steering torque because according to both \citet{moore2012human} and \citet{weir1973manual}  the rear frame roll angle is mainly
 controlled by steering. 
 \begin{equation}
    \dot{\mathbf{x}}=\mathbf{A} \mathbf{x}+\mathbf{B} T_\delta + \mathbf{H}_d w
    \label{eq:bikeEOM}
\end{equation}
\begin{equation}
    \mathbf{y}=\mathbf{C} \mathbf{x}+\mathbf{D} \mathbf{f}
\end{equation}
where matrices \ensuremath{A,B,C,D,H_d} are defined by:
\begin{align}
    \mathbf{A} &=\begin{bmatrix}
        -\mathbf{M}^{-1}v\mathbf{C}_{1} & -\mathbf{M}^{-1}(g \mathbf{K}_{0}+v^{2}\mathbf{K}_{2}) \\
        {\mathbf{I}_2}                    & {\mathbf{0}} \\  {\begin{matrix} {0} & { \frac{c cos\lambda}{w}}\end{matrix}} &  {\begin{matrix} 0 & { \frac{v cos\lambda}{w}}\end{matrix} } 
    \end{bmatrix} , \mathbf{B}=\left[ \begin{array}{c}{\mathbf{M}^{-1}} \\ {\mathbf{0}}\end{array}\right] \\
    \mathbf{C} &= {\mathbf{I}_5} , \mathbf{D}=\mathbf{0} \\
    \mathbf{H}_d &= \left[ \begin{array}{c}{\mathbf{M}^{-1}}{\begin{bmatrix} l_g \\ c_s\end{bmatrix} }  \\ {\mathbf{0}}\end{array}\right] 
\end{align}

\ensuremath{\mathbf{H}_d} is the matrix defining the dynamics of the lateral disturbance \ensuremath{w}. In this case the force application point was \ensuremath{l_g} distance from the ground. The constant \ensuremath{c_s} is the fraction of \ensuremath{w} that results in a steering torque in the handlebar assembly.

\subsection{Rider Control Model}\label{subsec:rider_model}

In order to investigate the effects of the torque feedback loop attributed to the golgi tendon organs a rider control model is created. The complete high level overview of the model is shown in \cref{fig:paper3}.
\begin{figure}[ht]
    \centering
    \captionsetup{justification=centering,margin=2cm}

    \includegraphics[scale=0.8]{images/high_level_block.pdf}
    \caption{Block diagram of the complete rider-bicycle model.} 
    \label{fig:paper3}
\end{figure}

The neuromuscular dyanmics block works as a second order filter to simulate the limitations of the human response. In state space form this block is expressed by :

\begin{align}
\dot{x}_{nm} &= \begin{bmatrix}0 & 1 \\ -\omega^2 & -2\zeta\omega\end{bmatrix} \begin{bmatrix} T_\delta \\ \dot{T}_\delta\end{bmatrix} + \begin{bmatrix} 0 \\ \omega^2\end{bmatrix} a \\
    y_{nm} &= \begin{bmatrix}1 & 0\end{bmatrix} \begin{bmatrix} T_\delta \\ \dot{T}_\delta\end{bmatrix}
        \label{eq:gnmBLOCK}
\end{align}

where \ensuremath{\zeta} is the damping coefficient and \ensuremath{\omega_c} is the cutoff frequency. These  parameters were chosen according to activation dynamics present in the shoulder joint \cite{happee2008posture}.

The steer angle and steer rate feedback is attributed to the muscle spindles, while the torque feedback is made possible with the help of the golgi tendon organs. The roll and heading angle come from the visual system. Lastly the roll rate feedback is attributed to the vestibular system. 

The bicycle model of \cref{eq:bikeEOM} is combined with the neuromuscular dynamics block of \cref{eq:gnmBLOCK} to create a combined  plant with state \ensuremath{x=[\dot{\phi}, \dot{\delta}, \phi, \delta, \psi, T_\delta \dot{T}_\delta]^{T}} ,input \ensuremath{a} and \ensuremath{w} and output \ensuremath{y=[\dot{\phi}, \dot{\delta}, \phi, \delta, \psi, T_\delta]^{T}}. In order to make possible the implementation of the predictor which is discrete in nature the state space representation of the combined plant is discretized with a time step of 0.001 \si{\second}. The equivalent model block diagram is shown in \cref{fig:paper4}.

\subsubsection{The reafferent optimal predictor}
Many strategies to counter time delays have been proposed in literature. The most basic predictor is the Smith Predictor, which has been explored in motor control research by \citet{miall1993cerebellum}. The smith predictor compensates for time delays through the use of an internal forward model of the controlled dynamics and an internal model of the sensory delay pathways. The forward model works by utilizing an efferent signal of the control input while the comparison between prediction and measurement is trying to simulate the human's ability to distinguish between reafference and exafference.  Unfortunately the  most basic smith predictor scheme does not work for unstable open loop systems \cite{smith1957closed}. In this work a modification to the normal smith predictor scheme is suggested. In place of the forward model an optimal tapped delay line is used that forward simulates the amount of steps according to the model of sensory delay. This works like a resetting forward model that is updated every time step by the delayed state so the predictor loop does not become unstable. A tapped delay line without the smith  correction can still work and has been implemented by \citet{van2001adaptive} for modelling stance control but it leads to predictions that do not contain any amount of the effect of the disturbance on the state. The predictor structure used in this work  can be seen in \cref{fig:paper4}.



 \begin{figure}[ht]
    \centering
    \captionsetup{justification=centering,margin=2cm}

    \includegraphics[scale=0.6]{images/low_level_block.pdf}
    \caption{Equivalent block diagram of the bicycle-rider system in discrete time. \ensuremath{A^*} ,\ensuremath{B^*} are the discretized matrices of the combined plant dynamics while d is the amount of time delay in number of time steps. The delayed output measurement is forwarded in time in the tapped delay line to produce the first undelayed estimate of the output \ensuremath{\hat{y}^p} , which is again delayed through a model of the time internal time delay. The difference between this re-delayed prediction with the delayed measurements creates the error \ensuremath{e} which is added back to  \ensuremath{\hat{y}^p}  to create the final corrected prediction \ensuremath{\hat{y}^c} }
    \label{fig:paper4}
\end{figure}

\subsection{Parameter Estimation }

In order to assess the effectiveness of the torque feedback loop, three models of incremental complexity are used. In the first the feedback pathways are fed into the controller without delays. In the second delays are added. The third one compensates for time delays by the use of the predictor described above. The three models have the  controller gains as free parameters. The gains are estimated by fitting the model output into the non-parametric data-set derived in \cite{dialynaseffect}.  The gains were estimated by minimization of the cost function 
\begin{equation}
    V_{N}(\boldsymbol{\theta})=\frac{1}{N} \sum_{k=1}^{N}\left[5\left(\hat{y}^{\delta}_k(\mathbf{\theta})-y^\delta_k\right)^{2}+\left(\hat{y}^{\psi}_k(\mathbf{\theta})-y^\psi_k\right)^{2}+8\cdot10^{-4}\left(\hat{y}^{T_\delta}_k(\mathbf{\theta})\right)^2\right]
    \label{eq:cost}
    \end{equation}

where \ensuremath{\boldsymbol{\theta}} is a vector containing all the free parameters, \ensuremath{\hat{y}^{\delta}} and \ensuremath{\hat{y}^{\psi}} are the outputs of the simulation for the measured external disturbance \ensuremath{w} and the vector of parameters  \ensuremath{\boldsymbol{\theta}} for steer angle and heading angle respectively, while \ensuremath{y^\delta} and \ensuremath{y^\psi} are the outputs of the non-parametric model and are calculated by convoluting the the impulse response functions \ensuremath{h^\delta} and \ensuremath{h^\psi} with the measured disturbance \ensuremath{w} respectively. The derivation of the non-parametric data-set is further explained in \cite{dialynaseffect}.

The first two terms  of the cost function are trying to match the steering and heading  response of the parametric model with that one of the non-parametric model, while the third on minimizes the amount of input torque generated in order to produce the best possible fit. The weights were chosen heuristically. For optimization the genetic algorithm with a fitness limit of 0.03 is first  used in order to produce a good starting parameter vector for gradient descend algorithm to take over, which finally finds the closest possible estimate of the global minimum. For the genetic algorithm a crossover fraction of 0.85  along with a population size 10 times the length of the parameter vector is used. The gains attributed to the muscle spindle sensors (\ensuremath{K_\delta} and \ensuremath{K_{\dot{\delta}}}) are constrained to be only positive. The assumption is that they work like a delayed steering stiffness and damping. Additionally, the parameters are constrained to fall under -250 and 250 so as to avoid unrealistically high gain values. 

The impulse response function of the median rider is used. This is determined by taking the mean impulse response function of each measured output and finding the participant which had the highest variance accounted for between the individual response and the mean across all speed levels.
Each system was identified for three different model conditions. In the first all six feedback pathways are used including torque feedback, on the second torque feedback is excluded from the model by assuming that its corresponding gain is zero. Finally in the third, six gains are again used but the plant dynamics are modified so as to simulate the feedback off case of the experimental condition as described in \cref{subsec:rider_model}.  As metric of model validity the variance accounted for between parametric and non-parametric output is used, defined as
\begin{equation}
\mathrm{VAF_d}(\boldsymbol{\theta})=1 -\sum_{k=1}^{n}\left(y^{d}(k)-\hat{y}^{d}(k, \boldsymbol{\theta})\right)^{2} / \sum_{k=1}^{n}\left(y^{d}(k)^{2}\right)
\end{equation} 
where \ensuremath{d=\{\phi,\delta,\psi\}}. 

In order to assess the importance of the torque feedback, the uncertainty of each parameter is found. Parameters with the lowest uncertainty contribute more to the fit so they are deemed more important. To find the uncertainty the covariance matrix is estimated from :
\begin{align}
    \operatorname{cov}_{\hat{\theta}}  &=V_N(\boldsymbol{\hat{\theta}})\boldsymbol{H}(\boldsymbol{\hat{\theta}})^{-1}\\ \text{with} \;\;\;\;  \boldsymbol{H}(\boldsymbol{\hat{\theta}})&= \frac{\partial^{2} V_N}{\partial \theta_{i} \partial \theta_{j}}
\end{align}

where \ensuremath{\boldsymbol{\hat{\theta}}} is the parameter  the closest estimate to the true vector \ensuremath{\theta^*} that produces the true global minimum and \ensuremath{\boldsymbol{H}} is the hessian matrix numerically estimated by the gradient descend algorithm.  However, since bigger parameters are going to have naturally larger variances the diagonal values are normalized by the parameter value to produce the coefficient of variation.

\begin{equation}
    CV_{i}=\sqrt{\frac{\sigma^{2}_{\hat{\theta_i}}}{\hat{\theta}_i^2}}
    \end{equation}

    where \ensuremath{\sigma^{2}_{\hat{\theta_i}}} are the diagonal elements of \ensuremath{ \operatorname{cov}_{\hat{\theta}}}.
% As far as the delays are concerned for \ensuremath{\delta} and \ensuremath{\dot{\delta}} which are attributed to the muscle spindle sensors and for the torque feedback which is attributed to the golgi tendon organs  a delay of 25 \si{\milli\second} is chosen \cite{van2002identification,de2002adaptation}. For the feedback states attributed to visual feedback such as the roll angle \ensuremath{\phi} and yaw angle \ensuremath{\psi} a much greater delay of 200 \si{\milli\second} is chosen. Finally for  the vestibular roll rate feedback a delay of 50 \si{\milli\second} is implemented \cite{barnett2013vestibular}. 
% \cite{whipple1899stability}


\section{Results}


\subsection{Zero Delay Model}
The results of the zero delay model are presented in \cref{tb:no_delay}. A fit of over 90 \% is easily achieved for both steer angle and heading, while for roll the discrepancy is larger. A  look into how the model approximates the measured rider input and bicycle states for the forward speed \ensuremath{3.6 \si{\meter\per\second}} is seen in \cref{fig:paper5}. The discrepancy in the roll angle fit can be explained by the fact that the model does not account for upper body motions which are expected to have a considerable impact on bicycle dynamics. 

\begin{figure}[!h]
    % \centering
    % \captionsetup{justification=centering,margin=2cm}
    \makebox[\textwidth][c]{\includegraphics[width=1.4\textwidth]{images/no_delay_result1.eps}}
    % \includegraphics[width=\textwidth]{images/no_delay_result1.eps}
    \caption{Comparison between parametric model output, non-parametric model ouput and measured signals for the speed level of 3.6 \si{\meter\per\second} for the case where torque feedback activated.}
    \label{fig:paper5}
\end{figure}


From the index of dispersion it is seen that the torque feedback gain \ensuremath{K_{T_\delta}} along with the steer rate gain \ensuremath{K_{\dot{\delta}}} contribute most in the fit, since the consistently have the lowest uncertainty level among all parameters. Additionally, \ensuremath{\mathit{VAF}_\delta} drops more than 15-20\% when the feedback is turned off (see \cref{tb:no_delay}). The steering angle response   becomes significantly more oscillatory when the feedback is turned off (see \cref{fig:paper6}). Roll stabilization performance does not seem to be affected, however steering effort considerably does. Worth noting that in the experimental feedback off case the level of fit degradation is almost non existent.

\begin{figure}[!h]
    \centering
    \captionsetup{justification=centering,margin=2cm}

    \includegraphics[width=\textwidth]{images/no_delay_fb_compare.eps}
    \caption{Steering, roll angles and input rider torque compared among torque feedback levels  for the forward speed of 3.6 \si{\meter\per\second}. The disturbance signal is not shown  to scale.}
    \label{fig:paper6}
\end{figure}



\subsection{Variable Delay Model}
The same procedure was repeated for the model but now introducing  delays in all feedback pathways. For \ensuremath{\delta} and \ensuremath{\dot{\delta}} which are attributed to the muscle spindle sensors and for the torque feedback which is attributed to the golgi tendon organs  a delay of 25 \si{\milli\second} is chosen \cite{van2002identification,de2002adaptation}. For the feedback states attributed to visual feedback such as the roll angle \ensuremath{\phi} and yaw angle \ensuremath{\psi} a much greater delay of 200 \si{\milli\second} is chosen. Finally for  the vestibular roll rate feedback a delay of 50 \si{\milli\second} is implemented \cite{barnett2013vestibular}. 

The results of the variable delay model are presented in \cref{tb:variable}.  Despite the fact that significant delay is introduced into the system the torque feedback loop manages to compensate maintaining a \ensuremath{\mathit{VAF}_\delta} of over 90 \% for low speed levels (see \cref{tb:variable} and \cref{fig:paper7}). In \cref{fig:paper8} the delayed response of the rider is visible between the dotted red and bold red line. This is further exaggerated in the two remaining conditions resulting in much more oscillatory steering responses with a visible impact on roll stabilization. The index of dispersion follows similar pattern as in the zero delay model, with the proportional heading and roll gains having the largest uncertainty while the steer rate and  torque feedback gain having the lowest. Between feedback on and feedback off, a much larger drop in VAF is noted. Additionally, a equally significant drop in the fit is noted for the experimental feedback off case, which was not present in the zero delay model. 






\begin{figure}[!h]
    \centering
    \captionsetup{justification=centering,margin=2cm}

    \includegraphics[width=\textwidth]{images/variable_delay_result1.eps}
    \caption{Comparison between variable delay model output, non-parametric model ouput and measured signals for the speed level of 2.8 \si{\meter\per\second} for the case where torque feedback is activated.}
    \label{fig:paper7}
\end{figure}

\begin{figure}[!h]
    \centering
    \captionsetup{justification=centering,margin=2cm}

    \includegraphics[width=\textwidth]{images/variable_delay_compare.eps}
    \caption{Steering, roll angles and input rider torque of the variable delay model  compared among torque feedback levels  for the forward speed of 2.8 \si{\meter\per\second}. The disturbance signal is not shown  to scale.}
    \label{fig:paper8}
\end{figure}


    \subsection{Final Model}

The final model of  \cref{fig:paper4} is implemented with a consistent time delay among sensory pathways equal to 50 \si{\milli\second}. Adaptation of the predictor to work with variable time delays is not part of the scope of this work. It is assumed that the internal model of bicycle and neuromusclular dynamics along with the internal model of the inherent time delay responsible for prediction is perfect for controlling the normal bicycle dynamics. However in the experimental off, where the steering dynamics change, the internal model is not updated in simulation on purpose. This falls inline with what was noted during the experiments where the subjects adapted to the new bicycle dynamics instantaneously, so a full "re-calibration" of the forward model is too far fetched. This way the extent to which the smith prediction principle can counter forward model inaccuracies is also tested. 


The optimization results for the final model are presented in \cref{tb:predict_model}. From the \ensuremath{\mathit{VAF}s} and the signals shown in \cref{fig:paper9} it is visible that the quality of the fit is comparable with the ideal zero delay case. The index of dispersion follows similar trends with the two previous models  with \ensuremath{K_\delta} being the most important for the fit as it has the lowest uncertainty. The drop between feedback conditions is also similar to the zero delay case. Furthermore, the steering response exhibits  the same oscillatory behaviour when torque feedback is completely disabled. However, the predictor manages to compensate in the feedback off experimental case and achieve good fit which was not present in the model with uncompensated time delays. 

\begin{figure}[!h]
    \centering
    \captionsetup{justification=centering,margin=2cm}

    \includegraphics[width=\textwidth]{images/predict_delay_result1.eps}
    \caption{Comparison between variable delay model output, non-parametric model ouput and measured signals for the speed level of 4.67 \si{\meter\per\second} for the case where torque feedback is activated.}
    \label{fig:paper9}
\end{figure}


\begin{figure}[!h]
    \centering
    \captionsetup{justification=centering,margin=2cm}

    \includegraphics[width=\textwidth]{images/predict_delay_compare2.eps}
    \caption{Steering, roll angles and input rider torque of the variable delay model  compared among torque feedback levels  for the forward speed of 4.67 \si{\meter\per\second}.The red dotted lines is the feedback on case of the zero delay model and is shown for reference. The disturbance signal is not shown  to scale.}
    \label{fig:paper10}
\end{figure}

In \crefrange{fig:results_compare12}{fig:results_compare34}  a complete comparison between rider models for all feedback conditions is presented. The response shown is the result of the first lateral perturbation of each individual run. The zero delay and prediction models exhibit almost identical responses as it was evident from the over 90\% fit achieved. The variable delay model lags behind in both the produced control input and bicycle output, as is expected. Worth noting the lag in the control input of the prediction model in the first few milliseconds after the perturbation. Despite that fact the model compensates and achieves similar output as the idealized zero delay case. This is a result of the fact that no matter how good the prediction algorithm is the human has no knowledge of the future so the response from the controller will start after the first state information arrives from the feedback pathways which are delayed. The forward model in this case does not help predict the state as it has no information of the external disturbance. 
% Please add the following required packages to your document preamble:
% \usepackage{multirow}





    \begin{figure}
        \centering
        \begin{subfigure}[b]{\textwidth}
            \centering
            \includegraphics[width=1\linewidth]{images/compare_models.eps}
            \caption{Comparison between the three rider models for forward speed 2.81 \si{\meter\per\second}}
            \label{fig:results_compare1}
        \end{subfigure}
        \begin{subfigure}[b]{\textwidth}
            \centering
            \includegraphics[width=1\linewidth]{images/compare_models2.eps}
            \caption{Comparison between the three rider models for forward speed 3.6 \si{\meter\per\second}}            
            \label{fig:results_compare2}
        \end{subfigure}
        \caption{Steering angle \ensuremath{\delta}, roll angle \ensuremath{\phi} and steering torque \ensuremath{T_\delta} compared among the three rider models implemented for all torque feedback conditions, for the two lowest speed levels.}
        \label{fig:results_compare12}
     \end{figure}



     \begin{figure}
        \centering
        \begin{subfigure}[b]{\textwidth}
            \centering
            \includegraphics[width=1\linewidth]{images/compare_models3.eps}
            \caption{Comparison between the three rider models for forward speed 4.67 \si{\meter\per\second}}
            \label{fig:results_compare3}
        \end{subfigure}
        \begin{subfigure}[b]{\textwidth}
            \centering
            \includegraphics[width=1\linewidth]{images/compare_models4.eps}
            \caption{Comparison between the three rider models for forward speed 5.71 \si{\meter\per\second}}            
            \label{fig:results_compare4}
        \end{subfigure}
        \caption{Steering angle \ensuremath{\delta}, roll angle \ensuremath{\phi} and steering torque \ensuremath{T_\delta} compared among the three rider models implemented for all torque feedback conditions, for the two highest speed levels.}
        \label{fig:results_compare34}
     \end{figure}


\begin{table}[]
    \caption{ Results for the zero delay model as estimated for the median rider for all speed levels. Results are presented for the three conditions. Haptic on/off differentiates based on the dyanmics of the bicycle model, while "with or w/o \ensuremath{T_\delta} feedback" differentiates based on the structure of the rider control model. The values of the gains are presented as well as their corresponding uncertainty level measured by the coefficient of variation \ensuremath{CV_i}. Additionally, the variance accounted for of the orientation outputs between parametric and non parametric signals is also presented. The derivative gains (\ensuremath{K_{\dot{\phi}}},\ensuremath{K_{\dot{\delta}}}) are measured in \si{\kilogram\square\meter\per\square\second} while the proportional gains (\ensuremath{K_{\phi}},\ensuremath{K_{\delta}},\ensuremath{K_{\psi}}) are measured in \si{\kilogram\square\meter\per\second}. The torque feedback gain \ensuremath{K_{T_\delta}} is dimensionless.}
    \label{tb:no_delay}
    \begin{tabular}{llcccccc}
    \hline
                                                   & Bicycle $\rightarrow$                                              & \multicolumn{4}{c}{Haptic On}                                                                                                                                                                         & \multicolumn{2}{c}{Haptic Off}                                                                    \\ \cline{2-8} 
                                                   & {\color[HTML]{333333} Rider $\;\;\;\;\rightarrow$} & \multicolumn{2}{l}{with $T_\delta$ feedback}                                                      & \multicolumn{2}{l}{w/o  $T_\delta$ feedback}                                                      & \multicolumn{2}{l}{with $T_\delta$ feedback}                                                      \\ \cline{2-8} 
                                                   &                                                                    & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                \\
    \multirow{-2}{*}{Forward Speed}                &                                                                    & \multicolumn{1}{l}{\multirow{-2}{*}{Value}} & \multicolumn{1}{l}{\multirow{-2}{*}{CV ($10^{-4}$)}} & \multicolumn{1}{l}{\multirow{-2}{*}{Value}} & \multicolumn{1}{l}{\multirow{-2}{*}{CV ($10^{-4}$)}} & \multicolumn{1}{l}{\multirow{-2}{*}{Value}} & \multicolumn{1}{l}{\multirow{-2}{*}{CV ($10^{-4}$)}} \\ \hline
                                                   & $K_{\dot{\phi}} $                                                  & -77.17                                      & 114.86                                              & -22.46                                      & 29.77                                               & -115.36                                     & 213.52                                              \\
    \multirow{-2}{*}{2.8 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                                 & 2.26                                        & 73.57                                               & 2.58                                        & 18.93                                               & 8.76                                        & 187.30                                              \\
                                                   & $K_{\phi} $                                                        & -164.88                                     & 132.25                                              & -24.50                                      & 73.14                                               & -248.24                                     & 217.05                                              \\
                                                   & $K_\delta $                                                        & 32.75                                       & 150.14                                              & 3.76                                        & 140.96                                              & 29.67                                       & 215.07                                              \\
                                                   & $K_\psi $                                                          & -63.22                                      & 133.29                                              & -9.85                                       & 53.71                                               & -93.44                                      & 223.02                                              \\
                                                   & $K_{T_\delta}$                                                     & 3.51                                        & 176.20                                              & -                                           & -                                                   & 7.53                                        & 223.83                                              \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                                & \multicolumn{2}{c}{77.80}                                                                         & \multicolumn{2}{c}{82.79}                                                                         & \multicolumn{2}{c}{78.37}                                                                         \\
                                                   & $\mathbf{VAF}_\delta$                                              & \multicolumn{2}{c}{98.34}                                                                         & \multicolumn{2}{c}{79.19}                                                                         & \multicolumn{2}{c}{98.20}                                                                         \\
                                                   & $\mathbf{VAF}_\psi$                                                & \multicolumn{2}{c}{93.46}                                                                         & \multicolumn{2}{c}{93.51}                                                                         & \multicolumn{2}{c}{93.74}                                                                         \\
                                                   &                                                                    & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                \\ \hline
                                                   & $K_{\dot{\phi}} $                                                  & -109.94                                     & 146.98                                              & -21.30                                      & 35.99                                               & -78.28                                      & 61.00                                               \\
    \multirow{-2}{*}{3.6 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                                 & 8.22                                        & 139.00                                              & 3.30                                        & 24.78                                               & 9.09                                        & 51.11                                               \\
                                                   & $K_{\phi} $                                                        & -248.47                                     & 147.39                                              & -34.64                                      & 71.54                                               & -229.14                                     & 84.40                                               \\
                                                   & $K_\delta $                                                        & 50.78                                       & 147.72                                              & 6.48                                        & 130.57                                              & 53.16                                       & 92.96                                               \\
                                                   & $K_\psi $                                                          & -132.13                                     & 152.08                                              & -17.74                                      & 61.92                                               & -103.75                                     & 74.49                                               \\
                                                   & $K_{T_\delta}$                                                     & 4.52                                        & 167.24                                              & -                                           & -                                                   & 6.89                                        & 64.17                                               \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                                & \multicolumn{2}{c}{79.92}                                                                         & \multicolumn{2}{c}{85.93}                                                                         & \multicolumn{2}{c}{80.89}                                                                         \\
                                                   & $\mathbf{VAF}_\delta$                                              & \multicolumn{2}{c}{98.83}                                                                         & \multicolumn{2}{c}{86.40}                                                                         & \multicolumn{2}{c}{97.08}                                                                         \\
                                                   & $\mathbf{VAF}_\psi$                                                & \multicolumn{2}{c}{95.33}                                                                         & \multicolumn{2}{c}{97.95}                                                                         & \multicolumn{2}{c}{95.15}                                                                         \\
                                                   &                                                                    & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                \\ \hline
                                                   & $K_{\dot{\phi}} $                                                  & -92.50                                      & 117.34                                              & -27.29                                      & 46.40                                               & -102.63                                     & 40.87                                               \\
    \multirow{-2}{*}{4.7 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                                 & 4.81                                        & 183.05                                              & 4.25                                        & 41.56                                               & 11.24                                       & 28.38                                               \\
                                                   & $K_{\phi} $                                                        & -183.03                                     & 135.64                                              & -38.17                                      & 76.43                                               & -249.74                                     & 74.10                                               \\
                                                   & $K_\delta $                                                        & 22.57                                       & 237.51                                              & 2.65                                        & 591.87                                              & 63.36                                       & 88.33                                               \\
                                                   & $K_\psi $                                                          & -165.42                                     & 126.89                                              & -33.78                                      & 63.74                                               & -188.67                                     & 58.81                                               \\
                                                   & $K_{T_\delta}$                                                     & 3.42                                        & 174.23                                              & -                                           & -                                                   & 8.98                                        & 13.88                                               \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                                & \multicolumn{2}{c}{77.03}                                                                         & \multicolumn{2}{c}{83.06}                                                                         & \multicolumn{2}{c}{78.60}                                                                         \\
                                                   & $\mathbf{VAF}_\delta$                                              & \multicolumn{2}{c}{97.57}                                                                         & \multicolumn{2}{c}{80.27}                                                                         & \multicolumn{2}{c}{95.57}                                                                         \\
                                                   & $\mathbf{VAF}_\psi$                                                & \multicolumn{2}{c}{91.41}                                                                         & \multicolumn{2}{c}{97.03}                                                                         & \multicolumn{2}{c}{92.48}                                                                         \\
                                                   &                                                                    & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                \\ \hline
                                                   & $K_{\dot{\phi}} $                                                  & -83.90                                      & 117.61                                              & -31.12                                      & 43.99                                               & -76.30                                      & 47.12                                               \\
    \multirow{-2}{*}{5.7 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                                 & 5.83                                        & 142.87                                              & 5.58                                        & 40.62                                               & 10.91                                       & 30.23                                               \\
                                                   & $K_{\phi} $                                                        & -166.08                                     & 127.89                                              & -43.64                                      & 67.14                                               & -208.33                                     & 83.09                                               \\
                                                   & $K_\delta $                                                        & 14.85                                       & 98.10                                               & 1.14                                        & 1836.39                                             & 79.44                                       & 75.47                                               \\
                                                   & $K_\psi $                                                          & -186.77                                     & 128.56                                              & -49.82                                      & 52.31                                               & -176.96                                     & 69.82                                               \\
                                                   & $K_{T_\delta}$                                                     & 3.24                                        & 185.07                                              & -                                           & -                                                   & 8.45                                        & 29.67                                               \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                                & \multicolumn{2}{c}{79.17}                                                                         & \multicolumn{2}{c}{84.03}                                                                         & \multicolumn{2}{c}{80.30}                                                                         \\
                                                   & $\mathbf{VAF}_\delta$                                              & \multicolumn{2}{c}{97.51}                                                                         & \multicolumn{2}{c}{84.09}                                                                         & \multicolumn{2}{c}{94.71}                                                                         \\
                                                   & $\mathbf{VAF}_\psi$                                                & \multicolumn{2}{c}{90.97}                                                                         & \multicolumn{2}{c}{96.41}                                                                         & \multicolumn{2}{c}{91.56}                                                                        
    \end{tabular}
    \end{table}

\begin{table}[]
    \caption{ Results for the variable delay model as estimated for the median rider for all speed levels. Results are presented for the three conditions. Haptic on/off differentiates based on the dyanmics of the bicycle model, while "with or w/o \ensuremath{T_\delta} feedback" differentiates based on the structure of the rider control model. The values of the gains are presented as well as their corresponding uncertainty level measured by the coefficient of variation \ensuremath{CV_i}. Additionally, the variance accounted for of the orientation outputs between parametric and non parametric signals is also presented. The derivative gains (\ensuremath{K_{\dot{\phi}}},\ensuremath{K_{\dot{\delta}}}) are measured in \si{\kilogram\square\meter\per\square\second} while the proportional gains (\ensuremath{K_{\phi}},\ensuremath{K_{\delta}},\ensuremath{K_{\psi}}) are measured in \si{\kilogram\square\meter\per\second}. The torque feedback gain \ensuremath{K_{T_\delta}} is dimensionless.}
    \label{tb:variable}
    \begin{tabular}{llcccccc}
    \hline
                                                   & Bicycle $\rightarrow$                                  & \multicolumn{4}{c}{Haptic On}                                                                                                                                                                           & \multicolumn{2}{c}{Haptic Off}                                                                     \\ \cline{2-8} 
                                                   & {\color[HTML]{333333} Rider $\;\;\;\;\rightarrow$} & \multicolumn{2}{l}{with $T_\delta$ feedback}                                                       & \multicolumn{2}{l}{w/o  $T_\delta$ feedback}                                                       & \multicolumn{2}{l}{with $T_\delta$ feedback}                                                       \\ \cline{2-8} 
                                                   &                                                        & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 \\
    \multirow{-2}{*}{Forward Speed}                &                                                        & \multicolumn{1}{l}{\multirow{-2}{*}{Value}} & \multicolumn{1}{l}{\multirow{-2}{*}{CV ($10^{-4}$)}} & \multicolumn{1}{l}{\multirow{-2}{*}{Value}} & \multicolumn{1}{l}{\multirow{-2}{*}{CV ($10^{-4}$)}} & \multicolumn{1}{l}{\multirow{-2}{*}{Value}} & \multicolumn{1}{l}{\multirow{-2}{*}{CV ($10^{-4}$)}} \\ \hline
                                                   & $K_{\dot{\phi}} $                                      & -68.53                                      & 38.72                                                & -14.93                                      & 37.52                                                & -28.19                                      & 35.15                                                \\
    \multirow{-2}{*}{2.8 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                     & 2.09                                        & 110.32                                               & 2.30                                        & 32.17                                                & 2.65                                        & 13.18                                                \\
                                                   & $K_{\phi} $                                            & -146.29                                     & 72.07                                                & -16.98                                      & 92.51                                                & -79.20                                      & 78.41                                                \\
                                                   & $K_\delta $                                            & 22.18                                       & 95.38                                                & 4.62                                        & 103.75                                               & 10.51                                       & 93.36                                                \\
                                                   & $K_\psi $                                              & -40.34                                      & 56.18                                                & -3.78                                       & 116.84                                               & -14.53                                      & 67.08                                                \\
                                                   & $K_{T_\delta}$                                         & 3.52                                        & 64.80                                                & -                                           & -                                                    & 2.59                                        & 29.48                                                \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                    & \multicolumn{2}{c}{81.15}                                                                          & \multicolumn{2}{c}{69.61}                                                                          & \multicolumn{2}{c}{80.01}                                                                          \\
                                                   & $\mathbf{VAF}_\delta$                                  & \multicolumn{2}{c}{93.43}                                                                          & \multicolumn{2}{c}{23.34}                                                                          & \multicolumn{2}{c}{66.84}                                                                          \\
                                                   & $\mathbf{VAF}_\psi$                                    & \multicolumn{2}{c}{93.78}                                                                          & \multicolumn{2}{c}{69.67}                                                                          & \multicolumn{2}{c}{83.30}                                                                          \\
                                                   &                                                        & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 \\ \hline
                                                   & $K_{\dot{\phi}} $                                      & -51.02                                      & 56.62                                                & -15.40                                      & 55.90                                                & -21.25                                      & 51.31                                                \\
    \multirow{-2}{*}{3.6 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                     & 2.50                                        & 170.45                                               & 2.81                                        & 50.20                                                & 2.79                                        & 17.72                                                \\
                                                   & $K_{\phi} $                                            & -120.51                                     & 85.28                                                & -22.82                                      & 102.83                                               & -76.41                                      & 90.89                                                \\
                                                   & $K_\delta $                                            & 16.58                                       & 153.27                                               & 3.94                                        & 243.76                                               & 17.14                                       & 84.92                                                \\
                                                   & $K_\psi $                                              & -43.06                                      & 79.41                                                & -7.37                                       & 147.32                                               & -13.30                                      & 103.52                                               \\
                                                   & $K_{T_\delta}$                                         & 3.42                                        & 62.79                                                & -                                           & -                                                    & 3.09                                        & 21.20                                                \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                    & \multicolumn{2}{c}{82.85}                                                                          & \multicolumn{2}{c}{79.48}                                                                          & \multicolumn{2}{c}{73.14}                                                                          \\
                                                   & $\mathbf{VAF}_\delta$                                  & \multicolumn{2}{c}{91.63}                                                                          & \multicolumn{2}{c}{53.29}                                                                          & \multicolumn{2}{c}{52.83}                                                                          \\
                                                   & $\mathbf{VAF}_\psi$                                    & \multicolumn{2}{c}{95.10}                                                                          & \multicolumn{2}{c}{84.88}                                                                          & \multicolumn{2}{c}{71.58}                                                                          \\
                                                   &                                                        & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 \\ \hline
                                                   & $K_{\dot{\phi}} $                                      & -51.78                                      & 64.60                                                & -19.26                                      & 349.70                                               & -14.88                                      & 55.92                                                \\
    \multirow{-2}{*}{4.7 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                     & 2.75                                        & 160.68                                               & 4.42                                        & 438.96                                               & 3.04                                        & 20.62                                                \\
                                                   & $K_{\phi} $                                            & -136.22                                     & 105.15                                               & -27.02                                      & 111.78                                               & -48.91                                      & 115.90                                               \\
                                                   & $K_\delta $                                            & 3.21                                        & 1156.00                                              & 0.01                                        & 492609.67                                            & 16.01                                       & 99.26                                                \\
                                                   & $K_\psi $                                              & -64.43                                      & 87.60                                                & -14.29                                      & 412.99                                               & -10.82                                      & 119.48                                               \\
                                                   & $K_{T_\delta}$                                         & 3.70                                        & 63.91                                                & -                                           & -                                                    & 2.61                                        & 30.62                                                \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                    & \multicolumn{2}{c}{77.86}                                                                          & \multicolumn{2}{c}{71.14}                                                                          & \multicolumn{2}{c}{63.73}                                                                          \\
                                                   & $\mathbf{VAF}_\delta$                                  & \multicolumn{2}{c}{81.63}                                                                          & \multicolumn{2}{c}{36.19}                                                                          & \multicolumn{2}{c}{15.61}                                                                          \\
                                                   & $\mathbf{VAF}_\psi$                                    & \multicolumn{2}{c}{90.32}                                                                          & \multicolumn{2}{c}{80.57}                                                                          & \multicolumn{2}{c}{55.71}                                                                          \\
                                                   &                                                        & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 \\ \hline
                                                   & $K_{\dot{\phi}} $                                      & -38.58                                      & 136.91                                               & -19.65                                      & 110.85                                               & -10.10                                      & 62.29                                                \\
    \multirow{-2}{*}{5.7 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                     & 1.13                                        & 2085.75                                              & 5.42                                        & 128.32                                               & 3.08                                        & 21.38                                                \\
                                                   & $K_{\phi} $                                            & -120.59                                     & 120.57                                               & -33.34                                      & 117.63                                               & -30.95                                      & 133.76                                               \\
                                                   & $K_\delta $                                            & 0.00                                        & 3969013.40                                           & 0.01                                        & 280859.33                                            & 18.46                                       & 79.69                                                \\
                                                   & $K_\psi $                                              & -60.65                                      & 95.03                                                & -19.20                                      & 183.00                                               & -8.17                                       & 131.56                                               \\
                                                   & $K_{T_\delta}$                                         & 4.27                                        & 191.50                                               & -                                           & -                                                    & 2.58                                        & 26.58                                                \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                    & \multicolumn{2}{c}{73.65}                                                                          & \multicolumn{2}{c}{70.08}                                                                          & \multicolumn{2}{c}{49.58}                                                                          \\
                                                   & $\mathbf{VAF}_\delta$                                  & \multicolumn{2}{c}{77.99}                                                                          & \multicolumn{2}{c}{40.64}                                                                          & \multicolumn{2}{c}{-}                                                                              \\
                                                   & $\mathbf{VAF}_\psi$                                    & \multicolumn{2}{c}{84.32}                                                                          & \multicolumn{2}{c}{79.50}                                                                          & \multicolumn{2}{c}{39.90}                                                                         
    \end{tabular}
    \end{table}

\begin{table}[]
    \caption{ Results for the ROP model as estimated for the median rider for all speed levels. Results are presented for the three conditions. Haptic on/off differentiates based on the dyanmics of the bicycle model, while "with or w/o \ensuremath{T_\delta} feedback" differentiates based on the structure of the rider control model. The values of the gains are presented as well as their corresponding uncertainty level measured by the coefficient of variation \ensuremath{CV_i}. Additionally, the variance accounted for of the orientation outputs between parametric and non parametric signals is also presented. The derivative gains (\ensuremath{K_{\dot{\phi}}},\ensuremath{K_{\dot{\delta}}}) are measured in \si{\kilogram\square\meter\per\square\second} while the proportional gains (\ensuremath{K_{\phi}},\ensuremath{K_{\delta}},\ensuremath{K_{\psi}}) are measured in \si{\kilogram\square\meter\per\second}. The torque feedback gain \ensuremath{K_{T_\delta}} is dimensionless.}
    \label{tb:predict}
    \begin{tabular}{llcccccc}
    \hline
                                                   & Bicycle $\rightarrow$                                  & \multicolumn{4}{c}{Haptics On}                                                                                                                                                                          & \multicolumn{2}{c}{Haptics Off}                                                                    \\ \cline{2-8} 
                                                   & {\color[HTML]{333333} Rider $\;\;\;\;\rightarrow$} & \multicolumn{2}{l}{with $T_\delta$ feedback}                                                       & \multicolumn{2}{l}{w/o  $T_\delta$ feedback}                                                       & \multicolumn{2}{l}{with $T_\delta$ feedback}                                                       \\ \cline{2-8} 
                                                   &                                                        & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 \\
    \multirow{-2}{*}{Forward Speed}                &                                                        & \multicolumn{1}{l}{\multirow{-2}{*}{Value}} & \multicolumn{1}{l}{\multirow{-2}{*}{CV ($10^{-4}$)}} & \multicolumn{1}{l}{\multirow{-2}{*}{Value}} & \multicolumn{1}{l}{\multirow{-2}{*}{CV ($10^{-4}$)}} & \multicolumn{1}{l}{\multirow{-2}{*}{Value}} & \multicolumn{1}{l}{\multirow{-2}{*}{CV ($10^{-4}$)}} \\ \hline
                                                   & $K_{\dot{\phi}} $                                      & -117.07                                     & 153.96                                               & -21.11                                      & 30.98                                                & -137.02                                     & 116.70                                               \\
    \multirow{-2}{*}{2.8 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                     & 3.52                                        & 150.97                                               & 2.59                                        & 18.53                                                & 10.91                                       & 108.44                                               \\
                                                   & $K_{\phi} $                                            & -248.50                                     & 159.45                                               & -24.00                                      & 81.61                                                & -249.38                                     & 118.66                                               \\
                                                   & $K_\delta $                                            & 47.43                                       & 167.35                                               & 4.39                                        & 131.79                                               & 23.39                                       & 153.29                                               \\
                                                   & $K_\psi $                                              & -94.42                                      & 161.46                                               & -8.72                                       & 61.07                                                & -97.63                                      & 119.57                                               \\
                                                   & $K_{T_\delta}$                                         & 5.26                                        & 190.30                                               & -                                           & -                                                    & 10.13                                       & 113.01                                               \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                    & \multicolumn{2}{c}{78.78}                                                                          & \multicolumn{2}{c}{82.85}                                                                          & \multicolumn{2}{c}{80.41}                                                                          \\
                                                   & $\mathbf{VAF}_\delta$                                  & \multicolumn{2}{c}{98.22}                                                                          & \multicolumn{2}{c}{71.52}                                                                          & \multicolumn{2}{c}{97.63}                                                                          \\
                                                   & $\mathbf{VAF}_\psi$                                    & \multicolumn{2}{c}{94.02}                                                                          & \multicolumn{2}{c}{91.92}                                                                          & \multicolumn{2}{c}{94.86}                                                                          \\
                                                   &                                                        & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 \\ \hline
                                                   & $K_{\dot{\phi}} $                                      & -103.91                                     & 220.15                                               & -20.03                                      & 42.10                                                & -129.88                                     & 125.12                                               \\
    \multirow{-2}{*}{3.6 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                     & 7.55                                        & 205.98                                               & 3.28                                        & 31.80                                                & 17.90                                       & 126.50                                               \\
                                                   & $K_{\phi} $                                            & -249.50                                     & 213.85                                               & -32.88                                      & 85.42                                                & -249.87                                     & 114.03                                               \\
                                                   & $K_\delta $                                            & 55.63                                       & 203.91                                               & 6.79                                        & 142.33                                               & 35.97                                       & 139.80                                               \\
                                                   & $K_\psi $                                              & -125.68                                     & 224.37                                               & -15.64                                      & 66.86                                                & -133.59                                     & 120.60                                               \\
                                                   & $K_{T_\delta}$                                         & 4.52                                        & 253.01                                               & -                                           & -                                                    & 9.89                                        & 83.15                                                \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                    & \multicolumn{2}{c}{81.64}                                                                          & \multicolumn{2}{c}{86.19}                                                                          & \multicolumn{2}{c}{83.39}                                                                          \\
                                                   & $\mathbf{VAF}_\delta$                                  & \multicolumn{2}{c}{98.02}                                                                          & \multicolumn{2}{c}{80.82}                                                                          & \multicolumn{2}{c}{97.11}                                                                          \\
                                                   & $\mathbf{VAF}_\psi$                                    & \multicolumn{2}{c}{96.21}                                                                          & \multicolumn{2}{c}{97.09}                                                                          & \multicolumn{2}{c}{97.15}                                                                          \\
                                                   &                                                        & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 \\ \hline
                                                   & $K_{\dot{\phi}} $                                      & -121.19                                     & 136.01                                               & -25.17                                      & 54.75                                                & -164.78                                     & 110.66                                               \\
    \multirow{-2}{*}{4.7 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                     & 5.79                                        & 173.62                                               & 4.27                                        & 53.52                                                & 24.07                                       & 97.55                                                \\
                                                   & $K_{\phi} $                                            & -247.23                                     & 131.94                                               & -35.90                                      & 91.38                                                & -249.79                                     & 102.96                                               \\
                                                   & $K_\delta $                                            & 36.74                                       & 151.80                                               & 4.18                                        & 433.29                                               & 17.36                                       & 324.16                                               \\
                                                   & $K_\psi $                                              & -214.97                                     & 140.95                                               & -28.64                                      & 78.59                                                & -238.76                                     & 112.77                                               \\
                                                   & $K_{T_\delta}$                                         & 4.84                                        & 155.81                                               & -                                           & -                                                    & 13.11                                       & 80.91                                                \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                    & \multicolumn{2}{c}{79.31}                                                                          & \multicolumn{2}{c}{82.12}                                                                          & \multicolumn{2}{c}{81.74}                                                                          \\
                                                   & $\mathbf{VAF}_\delta$                                  & \multicolumn{2}{c}{97.06}                                                                          & \multicolumn{2}{c}{71.92}                                                                          & \multicolumn{2}{c}{96.35}                                                                          \\
                                                   & $\mathbf{VAF}_\psi$                                    & \multicolumn{2}{c}{93.16}                                                                          & \multicolumn{2}{c}{95.95}                                                                          & \multicolumn{2}{c}{94.66}                                                                          \\
                                                   &                                                        & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 & \multicolumn{1}{l}{}                        & \multicolumn{1}{l}{}                                 \\ \hline
                                                   & $K_{\dot{\phi}} $                                      & -111.38                                     & 131.04                                               & -28.44                                      & 45.72                                                & -150.97                                     & 93.00                                                \\
    \multirow{-2}{*}{5.7 $\si{\meter\per\second}$} & $K_{\dot{\delta}}$                                     & 6.57                                        & 126.55                                               & 5.57                                        & 44.04                                                & 32.07                                       & 82.12                                                \\
                                                   & $K_{\phi} $                                            & -235.65                                     & 149.45                                               & -40.32                                      & 86.47                                                & -222.44                                     & 109.50                                               \\
                                                   & $K_\delta $                                            & 32.77                                       & 191.97                                               & 3.59                                        & 572.06                                               & 25.75                                       & 302.64                                               \\
                                                   & $K_\psi $                                              & -248.74                                     & 145.69                                               & -41.87                                      & 65.89                                                & -249.99                                     & 106.96                                               \\
                                                   & $K_{T_\delta}$                                         & 4.95                                        & 190.76                                               & -                                           & -                                                    & 14.63                                       & 74.50                                                \\ \cline{2-8} 
                                                   & $\mathbf{VAF}_\phi$                                    & \multicolumn{2}{c}{81.15}                                                                          & \multicolumn{2}{c}{83.31}                                                                          & \multicolumn{2}{c}{84.13}                                                                          \\
                                                   & $\mathbf{VAF}_\delta$                                  & \multicolumn{2}{c}{97.11}                                                                          & \multicolumn{2}{c}{75.79}                                                                          & \multicolumn{2}{c}{94.72}                                                                          \\
                                                   & $\mathbf{VAF}_\psi$                                    & \multicolumn{2}{c}{92.70}                                                                          & \multicolumn{2}{c}{96.05}                                                                          & \multicolumn{2}{c}{95.41}                                                                         
    \end{tabular}
    \end{table}
\section{Discussion}
 
Since in the control scheme the feedback is defined as negative, positive feedback gains produce torques opposite to the direction of the state that they act on. For example   positive \ensuremath{K_\delta} acting on the steering angle signal will lead to torques that always try to make steering angle equal to zero. This was a design choice for all gains related to muscle spindles, in order to simulate lower spinal reflexes which  lead to increased stiffness and damping of the handlebar assembly. This is the reason the index of dispersion for the gain \ensuremath{K_\delta} is so large for the cases where the estimate is near zero (see \cref{tb:variable}). The gradient descent algorithm if left unbounded would result in values lower than zero which would lead to a physiologically impossible reflex response.  

On the other hand, the proportional and derivative roll gains  are consistently negative among all models for all forward speeds and all torque feedback level conditions. This falls in line with what is believed to be the main balancing strategy for single track vehicles; the so called "steer into the fall". \ensuremath{K_\psi} always being negative means that the rider steers into the direction that heading is diverging, which  seems counter intuitive. However, this can be explained by the fact that the heading correction task and the roll stabilization are inherently coupled. \ensuremath{K_\psi} also exhibits a  consistent trend in all feedback conditions in all the rider models test. It decreases as the forwrad speed increases.  

While the assumption that steering is the only active control input for the task of bicycle roll stabilization is correct , a secondary task is not taken into account by leaving the upper body unconstrained, which revolves around balancing of the torso and head. As a result, \ensuremath{\mathit{VAF}_\phi} never reaches values higher than 85 \%. This assumption  was  confirmed by performing a non linear model simulation, where bicycle and rider where modelled as two inverted pendulums with torsional spring and dampers in the two hinges. It was found that when an  controller that tries to keep the center of mass of the upper pendulum constant, was activated the lean of the lower pendulum got worse. Consequently, the degree to which the rider can extrapolate information from their vestibular system to make deductions on the state of the bicycle is debatable, since the vestibular system measures roll rate and acceleration of the head and not the actual bicycle frame. However since this remains constant among conditions, the effectiveness of the torque feedback loop will remain analogous.

The torque feedback gain seems to be  one of the two  parameters that contribute most towards the fit; the other being the derivative steer angle gain. This is both indicated by the low index of dispersion and the fact that when the torque feedback loop is severed \ensuremath{\mathit{VAF}_\delta} drops significantly. Even in the variable delay model, torque feedback was potent enough to compensate for the delays and achieve over 90 \% fit in steering response for the lower forward speeds. This could be because torque inherently includes acceleration information and can give  the controller a preview of how the rest of the state is going to evolve. However, in the experimental feedback off condition a degradation in fitting performance was only noted for the model with uncompensated time delays. In this case torque feedback is still proportional to the steering acceleration so the "preview" information is not completely lost. However the rider receives no input for the effect of the disturbance cause the torque that would naturally transfer through the front wheel contact point is filtered by the uncoupled fork-handlebar connection.  Despite all that, in the final formulation of the model with prediction in place, the reduced torque information was not enough to negatively hinder the quality of the fit, which could explain why no difference was found between steering configurations in the experiments conducted in \cite{dialynaseffect}. Furthermore  the  prediction strategy used  manages to utilize the smith  principle to enhance the optimal  predictions of the tapped delay line with  information of the effect of the disturbance on the state through reafferent pathways and simultaneously compensate for internal model inaccuracies. Note that in the feedback off experimental case the internal mode was not updated to reflect the changed dynamics, but the predictor manages to filter out the small discrepancies by comparing the forward model output with the delayed state measurements.


\section{Conclusions}
A gray box rider model was created that compensates for time delay by the use of a resetting  internal forward model. The parameters were estimated through minimization of a cost function that both accounts for the riders consern towards perfomance and control effort. The results matched the measured non-parametric ouputs derived in \cite{dialynaseffect} with an acceptable level of fit. Contrary to what the initial conclusion might have been from looking at the results of the analysis done by \citet{dialynaseffect}, this work indicates that torque feedback is in fact crucial to the execution of the balancing task. Howeverm the torque feedback in the experimetns was not physiologically neutered, as a result  the remaining information was adequate for the rider to achieve comparable perfomance between conditions.


 
\begin{table}[h]
    \caption{Whipple model parameters for the steer-by-wire bicycle shown in figure.}

    \begin{tabular}{lllll}
    \cline{1-3}
    \multicolumn{1}{l}{Parameter}                                         & \multicolumn{1}{l}{Symbol} & \multicolumn{1}{l}{Value} &  &  \\ \cline{1-3}
    wheel base                                                              & w                           & \ensuremath{1.03 m}        &  &  \\
    trail                                                                   & c                           &  \ensuremath{0.0665 m}     &  &  \\
    steer axis tilt \ensuremath{(\pi / 2-\text { head angle })  }           & \ensuremath{\lambda}        &  \ensuremath{\pi \char`\\ 10}                          &  &  \\
    rear wheel                                                              & R                           &                            &  &  \\
    radius                                                                  & \ensuremath{r_R}            &  \ensuremath{0.6858 m}     &  &  \\
    mass                                                                    & \ensuremath{m_R}            &  \ensuremath{8.5 \; kg}    &  &  \\
    mass moment of intertia                                                 &  \ensuremath{(I_{R_{xx}},I_{R_{yy}})} &  \ensuremath{(0.095625,0.19125) \;kg\;m^2}   &  &  \\
    rear body and frame assembly                                            & B                           &                            &  &  \\
    position centre of mass                                                 &  \ensuremath{\left(x_{\mathrm{B}}, z_{\mathrm{B}}\right)}              &       \ensuremath{(0.4,-0.6)}        &  &  \\
    mass                                                                    &     \ensuremath{m_B}           &  \ensuremath{95 kg}             &  &  \\
    mass moment of inertia                                                  &    \ensuremath{\left[ \begin{array}{ccc}{I_{\mathrm{Bxx}}} & {0} & {I_{\mathrm{B} x z}} \\ {0} & {I_{\mathrm{B} y y}} & {0} \\ {I_{\mathrm{B} x z}} & {0} & {I_{\mathrm{B} z z}}\end{array}\right]}            &     \ensuremath{\left[ \begin{array}{ccc}{9.2} & {0} & {2.4} \\ {0} & {11} & {0} \\ {2.4} & {0} & {2.8}\end{array}\right] \mathrm{kg\;m}^{2}}          &  &  \\
    front handlebar and fork assembly                                       & H                           &                            &  &  \\
    position centre of mass                                                 &    \ensuremath{\left(x_{\mathrm{H}}, z_{\mathrm{H}}\right)}            &   \ensuremath{(0.9,-0.66)}            &  &  \\
    mass                                                                    &     \ensuremath{m_H}           &    \ensuremath{1.5 kg}           &  &  \\
    mass moment of inertia                                                  &   \ensuremath{\left[ \begin{array}{ccc}{I_{\mathrm{H} x x}} & {0} & {I_{\mathrm{H} x z}} \\ {0} & {I_{\mathrm{Hyy}}} & {0} \\ {I_{\mathrm{Hxz}}} & {0} & {I_{\mathrm{H} z z}}\end{array}\right]}             &     \ensuremath{\left[ \begin{array}{ccc}{0.05892} & {0} & {-0.00756} \\ {0} & {0.06} & {0} \\ {-0.00756} & {0} & {0.00708}\end{array}\right] \mathrm{kg\;m}^{2}}          &  &  \\
    front wheel                                                             & F                           &                            &  &  \\
    radius                                                                  &     \ensuremath{r_F}           &    \ensuremath{0.6858 m}           &  &  \\
    mass                                                                    &     \ensuremath{m_F}           &     \ensuremath{1.84 kg}          &  &  \\
    mass moment of inertia                                                  &   \ensuremath{\left(I_{\mathrm{Fxx}}, I_{\mathrm{F} y y}\right)}             &    \ensuremath{(0.097,0.195) \mathrm{kg} \;\mathrm{m}^{2}}           &  &  \\
   battery rack                                      & b                           &                            &  &  \\
    position centre of mass                                                 &    \ensuremath{\left(x_{\mathrm{b}}, z_{\mathrm{b}}\right)}            &   \ensuremath{(0.4,-0.55)}            &  &  \\
    mass                                                                    &     \ensuremath{m_H}           &    \ensuremath{4 kg}           &  &  \\
    mass moment of inertia                                                  &   \ensuremath{\left[ \begin{array}{ccc}{I_{\mathrm{H} x x}} & {0} & {I_{\mathrm{H} x z}} \\ {0} & {I_{\mathrm{Hyy}}} & {0} \\ {I_{\mathrm{Hxz}}} & {0} & {I_{\mathrm{H} z z}}\end{array}\right]}             &     \ensuremath{\left[ \begin{array}{ccc}{0.02} & {0} & {-0.02} \\ {0} & {0.04} & {0} \\ {-0.02} & {0} & {0.02}\end{array}\right] \mathrm{kg\;m}^{2}}          &  &  \\
    
    
    \end{tabular}
    \captionsetup{justification=centering,margin=2cm}
    \label{tb:paper1}
    \end{table}

